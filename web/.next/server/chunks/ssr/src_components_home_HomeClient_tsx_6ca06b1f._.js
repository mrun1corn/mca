module.exports=[74920,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(33217),e=a.i(42292),f=a.i(46271);function g({label:a,value:c,helper:d,icon:e,onClick:g}){let h=g?f.motion.button:f.motion.div;return(0,b.jsx)(h,{type:g?"button":void 0,onClick:g,className:`rounded-2xl border border-white/60 dark:border-[#2b1f4a] bg-gradient-to-br from-[#FDF5FF] via-[#E9A5F1]/60 to-[#C68EFD]/40 dark:from-[#281745] dark:via-[#1f1136] dark:to-[#120926] p-5 shadow-lg shadow-[#C68EFD]/20 transition ${g?"text-left focus:outline-none focus:ring-2 focus:ring-blue-400/40 cursor-pointer":""}`,initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2},whileHover:{y:-4},whileTap:g?{scale:.98}:void 0,children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[e?(0,b.jsx)("div",{className:"text-blue-600 dark:text-blue-300",children:e}):null,(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-400",children:a}),(0,b.jsx)("p",{className:"text-2xl font-semibold text-slate-900 dark:text-white mt-2",children:c}),d?(0,b.jsx)("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:d}):null]})]})})}var h=a.i(90075);function i({member:a,onSelect:c}){let d=f.motion.button;return(0,b.jsx)(d,{type:"button",onClick:()=>{c&&c(a.userId)},className:`w-full text-left rounded-2xl border border-white/70 dark:border-[#2b1f4a] bg-gradient-to-br from-[#FDF5FF]/90 via-[#E9A5F1]/60 to-[#C68EFD]/50 dark:from-[#271444]/80 dark:via-[#1f0f37]/60 dark:to-[#140a25]/60 p-4 shadow-lg shadow-[#8F87F1]/15 ${c?"focus:outline-none focus:ring-2 focus:ring-[#C68EFD]/40":""}`,whileHover:{y:-4,boxShadow:"0 20px 30px rgba(143,135,241,0.25)"},whileTap:{scale:.98},transition:{duration:.2,ease:[.16,1,.3,1]},children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-base font-semibold text-slate-900 dark:text-white",children:a.name}),(0,b.jsxs)("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:["Last month ",(0,h.formatBDT)(a.lastMonth||0)]})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Balance"}),(0,b.jsx)("p",{className:"text-sm font-semibold text-emerald-600 dark:text-emerald-300",children:(0,h.formatBDT)(a.balance||0)})]})]})})}var j=a.i(37984),k=a.i(70025),l=a.i(37927),m=a.i(62036),n=a.i(21216),o=a.i(47482),p=a.i(13411),q=a.i(10380),r=a.i(45263),s=a.i(7078),t=a.i(93026),u=a.i(60225),v=a.i(9751);function w({userId:a,role:e,onClose:g}){let i=(0,l.useQueryClient)(),{notify:j}=(0,u.useToast)(),[w,x]=(0,c.useState)("ledger"),[y,z]=(0,c.useState)(null),[A,B]=(0,c.useState)("");(0,c.useEffect)(()=>{y&&"deposit"===y.type?B((y.amount/100).toFixed(2)):B("")},[y]),(0,v.useLockBodyScroll)(!0);let C=(0,d.useQuery)({queryKey:["txs",a],queryFn:async()=>(await o.api.get("/transactions",{params:{userId:a}})).data,enabled:!!a}),D=(0,d.useQuery)({queryKey:["dues",a],queryFn:async()=>(await o.api.get(`/users/${a}/dues`)).data,enabled:!!a}),E=(0,k.useMutation)({mutationFn:({id:a,body:b})=>o.api.patch(`/transactions/${a}`,b),onMutate:async({id:b,body:c})=>{await i.cancelQueries({queryKey:["txs",a]});let d=i.getQueryData(["txs",a]);return d&&i.setQueryData(["txs",a],d.map(a=>a._id===b?{...a,note:c.note??a.note,occurredAt:c.date??a.occurredAt,amount:c.amount?Math.round(100*c.amount):a.amount}:a)),{previous:d}},onError:(b,c,d)=>{d?.previous&&i.setQueryData(["txs",a],d.previous),j("Update failed","error")},onSuccess:()=>j("Transaction updated","success"),onSettled:()=>{i.invalidateQueries({queryKey:["txs",a]}),z(null)}}),F=(0,k.useMutation)({mutationFn:a=>o.api.delete(`/transactions/${a}`),onMutate:async b=>{await i.cancelQueries({queryKey:["txs",a]});let c=i.getQueryData(["txs",a]);return c&&i.setQueryData(["txs",a],c.filter(a=>a._id!==b)),{previous:c}},onError:(b,c,d)=>{d?.previous&&i.setQueryData(["txs",a],d.previous),j(b?.response?.data?.error||"Delete failed","error")},onSuccess:()=>j("Transaction deleted","success"),onSettled:()=>i.invalidateQueries({queryKey:["txs",a]})}),G="user"!==e,H=(0,n.useReducedMotion)();return(0,b.jsxs)(f.motion.div,{className:"fixed inset-0 z-40 bg-gradient-to-b from-white via-slate-50 to-blue-50 dark:from-slate-950 dark:via-slate-900 dark:to-slate-950 overflow-hidden",variants:H?{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0}}:{initial:{y:"100%"},animate:{y:0,transition:{duration:.3,ease:[.16,1,.3,1]}},exit:{y:"100%",transition:{duration:.22,ease:[.4,0,1,1]}}},initial:"initial",animate:"animate",exit:"exit",children:[(0,b.jsxs)("div",{className:"w-full min-h-screen px-4 py-6 sm:px-6 lg:px-10",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-400",children:"Member"}),(0,b.jsx)("h3",{className:"text-2xl font-semibold text-slate-900 dark:text-white",children:"Account overview"})]}),(0,b.jsx)("button",{type:"button",className:"p-2 rounded-full border border-slate-200 dark:border-slate-700 hover:bg-white/70 dark:hover:bg-slate-900/60",onClick:g,"aria-label":"Close member drawer",children:(0,b.jsx)(t.CloseIcon,{})})]}),(0,b.jsx)("div",{className:"flex flex-wrap items-center gap-2 border-b border-slate-100 dark:border-slate-800 mb-4 text-sm",children:["ledger","deposit","withdraw","dues"].map(a=>(0,b.jsx)("button",{type:"button",className:`px-3 py-2 rounded-full transition ${w===a?"bg-blue-600 text-white":"bg-white/70 text-slate-600 dark:bg-slate-900/40 dark:text-slate-300"}`,onClick:()=>x(a),children:a.charAt(0).toUpperCase()+a.slice(1)},a))}),"deposit"===w?(0,b.jsx)(p.default,{userId:a}):null,"withdraw"===w?(0,b.jsx)(q.default,{userId:a}):null,"ledger"===w?(0,b.jsxs)("div",{className:"flex flex-col h-[calc(100vh-200px)] pb-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-12 text-xs text-slate-500 px-2",children:[(0,b.jsx)("div",{className:"col-span-3",children:"Date"}),(0,b.jsx)("div",{className:"col-span-4",children:"Details"}),(0,b.jsx)("div",{className:"col-span-3 text-right",children:"Amount"}),(0,b.jsx)("div",{className:"col-span-2 text-right",children:"Actions"})]}),C.isLoading?(0,b.jsx)("div",{className:"p-4",children:(0,b.jsx)(r.SkeletonTableRows,{rows:4})}):C.data?.length?(0,b.jsx)("div",{className:"space-y-1 flex-1 overflow-auto pr-1 mt-2",children:C.data.map(a=>{let c="deposit"===a.type,d=G&&c;return(0,b.jsxs)("div",{className:"grid grid-cols-12 items-center px-2 py-2 text-sm border-b border-slate-100 dark:border-slate-900/40",children:[(0,b.jsx)("span",{className:"col-span-3",children:new Date(a.occurredAt).toLocaleDateString("en-BD")}),(0,b.jsx)("span",{className:`col-span-4 ${c?"text-emerald-600":"text-rose-500"}`,children:a.note||(c?"Deposit":"Withdrawal")}),(0,b.jsx)("span",{className:"col-span-3 text-right font-medium",children:(0,h.formatBDT)(a.amount)}),(0,b.jsxs)("span",{className:"col-span-2 flex justify-end gap-2 flex-wrap",children:[(0,b.jsxs)(s.default,{type:"button",variant:"ghost",className:"w-20 justify-center px-3 py-1 text-xs flex items-center gap-1 rounded-full bg-[#8F87F1]/20 text-[#5b3cc4] hover:bg-[#8F87F1]/30 dark:bg-[#4c3c8c]/40 dark:text-white",onClick:()=>z({...a,occurredAt:new Date(a.occurredAt).toISOString().slice(0,10)}),disabled:!G,title:G?"Edit transaction":"View only",children:[(0,b.jsx)(t.PencilIcon,{className:"w-3.5 h-3.5"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"Edit"})]}),(0,b.jsxs)(s.default,{type:"button",variant:"danger",className:"w-20 justify-center px-3 py-1 text-xs flex items-center gap-1 rounded-full",onClick:()=>{d&&confirm("Delete this transaction?")&&F.mutate(a._id)},disabled:!d,title:d?"Delete deposit":"Only deposits can be deleted",children:[(0,b.jsx)(t.TrashIcon,{className:"w-3.5 h-3.5"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"Delete"})]})]})]},a._id)})}):(0,b.jsx)("div",{className:"text-sm text-slate-500 px-2 py-3",children:"No transactions yet."})]}):null,"dues"===w?(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"grid grid-cols-3 text-xs text-slate-500 px-2 mb-2",children:[(0,b.jsx)("span",{children:"Due date"}),(0,b.jsx)("span",{children:"Amount"}),(0,b.jsx)("span",{className:"text-right",children:"Status"})]}),D.isLoading?(0,b.jsx)("div",{className:"p-4",children:(0,b.jsx)(r.SkeletonList,{rows:3})}):D.data?.length?(0,b.jsx)("div",{className:"space-y-2 max-h-72 overflow-auto",children:D.data.map(a=>(0,b.jsxs)("div",{className:"rounded-xl border border-slate-200 dark:border-slate-800",children:[(0,b.jsxs)("div",{className:"px-3 py-2 text-xs text-slate-500 dark:text-slate-400",children:["Principal: ",(0,h.formatBDT)(a.principal)]}),a.schedule.slice(0,4).map((c,d)=>(0,b.jsxs)("div",{className:"grid grid-cols-3 items-center px-3 py-1 border-t border-slate-100 dark:border-slate-900/40 text-sm",children:[(0,b.jsx)("span",{children:new Date(c.dueDate).toLocaleDateString("en-BD")}),(0,b.jsx)("span",{children:(0,h.formatBDT)(c.totalDuePoisha)}),(0,b.jsx)("span",{className:"text-right capitalize text-xs",children:c.status})]},`${a._id}-${d}`))]},a._id))}):(0,b.jsx)("div",{className:"text-sm text-slate-500 px-2 py-3",children:"No dues scheduled."})]}):null]}),(0,b.jsx)(m.AnimatePresence,{children:y?(0,b.jsx)(f.motion.div,{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>z(null),children:(0,b.jsxs)(f.motion.div,{className:"w-[calc(100%-2rem)] max-w-md rounded-2xl border border-slate-200 dark:border-slate-800 bg-white/90 dark:bg-slate-950/85 p-5 shadow-xl",variants:H?{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0}}:{initial:{scale:.96,opacity:0},animate:{scale:1,opacity:1,transition:{duration:.2,ease:[.16,1,.3,1]}},exit:{scale:.96,opacity:0,transition:{duration:.15,ease:[.4,0,1,1]}}},initial:"initial",animate:"animate",exit:"exit",onClick:a=>a.stopPropagation(),children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsx)("h4",{className:"text-base font-semibold text-slate-900 dark:text-white",children:"Edit transaction"}),(0,b.jsx)("button",{type:"button",className:"p-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800",onClick:()=>z(null),children:(0,b.jsx)(t.CloseIcon,{})})]}),(0,b.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,b.jsxs)("label",{className:"space-y-1 block",children:[(0,b.jsx)("span",{className:"text-slate-600 dark:text-slate-300",children:"Date"}),(0,b.jsx)("input",{type:"date",className:"input-like",value:y.occurredAt,onChange:a=>z(b=>b?{...b,occurredAt:a.target.value}:b)})]}),(0,b.jsxs)("label",{className:"space-y-1 block",children:[(0,b.jsx)("span",{className:"text-slate-600 dark:text-slate-300",children:"Note"}),(0,b.jsx)("input",{className:"input-like",value:y.note||"",onChange:a=>z(b=>b?{...b,note:a.target.value}:b)})]}),(0,b.jsxs)("label",{className:"space-y-1 block",children:[(0,b.jsx)("span",{className:"text-slate-600 dark:text-slate-300",children:"Amount (BDT)"}),(0,b.jsx)("input",{className:"input-like",type:"number",step:"0.01",value:A,onChange:a=>{B(a.target.value);let b=Number(a.target.value);Number.isFinite(b)&&z(a=>a?{...a,amount:Math.round(100*b)}:a)},disabled:"deposit"!==y.type}),"deposit"!==y.type?(0,b.jsx)("p",{className:"text-xs text-slate-500",children:"Withdrawals & investments lock the amount to keep group splits accurate."}):null]})]}),(0,b.jsxs)("div",{className:"mt-4 flex justify-end gap-2",children:[(0,b.jsx)(s.default,{type:"button",variant:"ghost",onClick:()=>z(null),children:"Cancel"}),(0,b.jsx)(s.default,{type:"button",disabled:E.isPending,onClick:()=>{if(!y)return;let a={note:y.note,date:y.occurredAt};if("deposit"===y.type&&A){let b=Number(A);Number.isFinite(b)&&(a.amount=b)}E.mutate({id:y._id,body:a})},children:E.isPending?"Saving…":"Save changes"})]})]})}):null})]})}function x({open:a,totalDeposits:c,totalWithdraws:i,available:j,rows:k,onClose:l}){(0,v.useLockBodyScroll)(a);let m=(0,d.useQuery)({queryKey:["withdrawals","totals"],queryFn:async()=>(await o.api.get("/transactions",{params:{type:"withdraw",limit:20}})).data,enabled:a}),p=(0,d.useQuery)({queryKey:["investments","totals"],queryFn:async()=>(await o.api.get("/investments")).data,enabled:a});if(!a)return null;let q=(0,n.useReducedMotion)();return(0,b.jsx)(f.motion.div,{className:"fixed inset-0 z-40 bg-gradient-to-b from-white via-emerald-50 to-slate-50 dark:from-slate-950 dark:via-slate-900 dark:to-slate-950 overflow-y-auto",variants:q?{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0}}:{initial:{y:"100%"},animate:{y:0,transition:{duration:.32,ease:[.16,1,.3,1]}},exit:{y:"100%",transition:{duration:.22,ease:[.4,0,1,1]}}},initial:"initial",animate:"animate",exit:"exit",children:(0,b.jsxs)("div",{className:"w-full min-h-screen px-4 py-6 sm:px-6",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between mb-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-400",children:"Total balance"}),(0,b.jsx)("h2",{className:"text-2xl font-semibold text-slate-900 dark:text-white",children:"Collections vs. deductions"})]}),(0,b.jsx)("button",{type:"button",className:"text-sm text-slate-500 hover:text-rose-500",onClick:l,children:"Close"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2 xl:grid-cols-4 mb-4",children:[(0,b.jsx)(g,{label:"Collected overall",value:(0,h.formatBDT)(c)}),(0,b.jsx)(g,{label:"Deducted / invested",value:(0,h.formatBDT)(i)}),(0,b.jsx)(g,{label:"Net balance",value:(0,h.formatBDT)(c-i)}),(0,b.jsx)(g,{label:"Available cash",value:(0,h.formatBDT)(j)})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:[(0,b.jsx)(e.default,{title:"Per-member totals",description:"Lifetime deposits vs. deductions.",children:(0,b.jsx)("div",{className:"overflow-auto max-h-72 pr-1",children:(0,b.jsxs)("table",{className:"min-w-[520px] text-sm",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"text-left text-slate-500 dark:text-slate-400",children:[(0,b.jsx)("th",{className:"py-2 pr-3 font-medium",children:"Member"}),(0,b.jsx)("th",{className:"py-2 px-3 font-medium text-right",children:"Deposited"}),(0,b.jsx)("th",{className:"py-2 px-3 font-medium text-right",children:"Deducted"}),(0,b.jsx)("th",{className:"py-2 pl-3 font-medium text-right",children:"Balance"})]})}),(0,b.jsxs)("tbody",{children:[k.map(a=>(0,b.jsxs)("tr",{className:"border-t border-slate-100 dark:border-slate-800",children:[(0,b.jsx)("td",{className:"py-2 pr-3 font-medium text-slate-900 dark:text-white",children:a.name}),(0,b.jsx)("td",{className:"py-2 px-3 text-right",children:(0,h.formatBDT)(a.totalDeposits||0)}),(0,b.jsx)("td",{className:"py-2 px-3 text-right",children:(0,h.formatBDT)(a.totalWithdraws||0)}),(0,b.jsx)("td",{className:"py-2 pl-3 text-right font-semibold text-emerald-600 dark:text-emerald-300",children:(0,h.formatBDT)(a.balance||0)})]},a.userId)),!k.length&&(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:4,className:"py-3 text-center text-slate-500",children:"No members yet."})})]})]})})}),(0,b.jsx)(e.default,{title:"Recent withdrawals / investments",description:"Latest 20 records",children:m.isLoading?(0,b.jsx)(r.SkeletonList,{rows:4}):m.data?.length?(0,b.jsx)("div",{className:"space-y-2 max-h-72 overflow-auto pr-1",children:m.data.map(a=>(0,b.jsxs)("div",{className:"rounded-2xl border border-slate-200 dark:border-slate-800 p-3 flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-semibold text-slate-900 dark:text-white",children:a.note||"Withdrawal"}),(0,b.jsx)("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:new Date(a.occurredAt).toLocaleDateString("en-BD")})]}),(0,b.jsx)("p",{className:"text-sm font-semibold text-rose-600 dark:text-rose-300",children:(0,h.formatBDT)(Math.abs(a.amount||0))})]},a._id))}):(0,b.jsx)("p",{className:"text-sm text-slate-500",children:"No withdrawals recorded yet."})})]}),(0,b.jsx)(e.default,{title:"Investments overview",description:"Funds currently out of circulation.",children:p.isLoading?(0,b.jsx)(r.SkeletonList,{rows:3}):p.data?.length?(0,b.jsx)("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:p.data.map(a=>{let c=a.returnedPoisha||0,d=a.amountPoisha+(a.expectedInterestPoisha||0),e=d?Math.min(100,Math.round(c/d*100)):0;return(0,b.jsxs)("div",{className:"rounded-2xl border border-slate-200 dark:border-slate-800 p-4 space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("p",{className:"font-semibold text-slate-900 dark:text-white",children:a.name}),(0,b.jsx)("span",{className:"text-xs px-2 py-0.5 rounded-full border border-slate-200 dark:border-slate-700 text-slate-500 dark:text-slate-300",children:"completed"===a.status?"Completed":"Active"})]}),(0,b.jsxs)("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:["Principal: ",(0,h.formatBDT)(a.amountPoisha)]}),(0,b.jsxs)("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:["Returned ",(0,h.formatBDT)(c)," of ",(0,h.formatBDT)(d)," (",e,"%)"]}),(0,b.jsx)("div",{className:"w-full h-1.5 rounded-full bg-slate-100 dark:bg-slate-800 overflow-hidden",children:(0,b.jsx)("div",{className:"h-full bg-emerald-500",style:{width:`${e}%`}})})]},a.id)})}):(0,b.jsx)("p",{className:"text-sm text-slate-500",children:"No investments recorded yet."})})]})})}var y=a.i(50944);function z(){let a=(0,y.useRouter)(),d=new Date().getFullYear(),e=[d,d-1],[f,g]=(0,c.useState)({}),[i,j]=(0,c.useState)(!1),[k,l]=(0,c.useState)(null);return(0,c.useEffect)(()=>{let a=!1;return async function(){j(!0),l(null);try{let b=await Promise.all(e.map(async a=>{let b=await o.api.get("/reports/yearly-collection",{params:{year:a}});return{year:a,total:b.data?.total??0}}));a||g(b.reduce((a,b)=>({...a,[b.year]:b.total}),{}))}catch(b){a||l(b?.response?.data?.error||"Failed to load yearly totals")}finally{a||j(!1)}}(),()=>{a=!0}},[d]),(0,b.jsxs)("section",{className:"space-y-3",children:[(0,b.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-400",children:"Yearly collection"}),(0,b.jsx)("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:e.map(c=>{let d=f[c];return(0,b.jsxs)("button",{type:"button",onClick:()=>a.push(`/yearly?year=${c}`),className:"text-left rounded-2xl border border-slate-200 dark:border-slate-800 bg-white/80 dark:bg-slate-900/70 p-4 shadow-sm transition hover:shadow-md focus:outline-none focus:ring-2 focus:ring-blue-400/40",children:[(0,b.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-400",children:"Collection year"}),(0,b.jsx)("p",{className:"text-2xl font-semibold text-slate-900 dark:text-white mt-1",children:c}),(0,b.jsx)("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-2",children:"number"==typeof d?(0,h.formatBDT)(d):i?"Loading…":"Tap to view details"})]},c)})}),k?(0,b.jsx)("p",{className:"text-sm text-rose-500",children:k}):null]})}function A({initialData:a,me:f}){let k=(0,y.useRouter)(),[l,n]=(0,c.useState)(null),[p,q]=(0,c.useState)(!1),r=(0,d.useQuery)({queryKey:["home"],queryFn:async()=>(await o.api.get("/home")).data,initialData:a,staleTime:3e4,gcTime:12e4,refetchOnWindowFocus:!1}),s=r.data,t=r.isFetching&&!!r.data,u=(0,d.useQuery)({queryKey:["dues",f.id],queryFn:async()=>(await o.api.get(`/users/${f.id}/dues`)).data,enabled:"user"===f.role&&!!f.id,staleTime:3e4,refetchOnWindowFocus:!1}),v=(0,d.useQuery)({queryKey:["txs",f.id,12],queryFn:async()=>(await o.api.get("/transactions",{params:{userId:f.id,limit:20}})).data,enabled:"user"===f.role&&!!f.id,staleTime:3e4,refetchOnWindowFocus:!1}),A=(0,c.useMemo)(()=>{if("user"!==f.role||!u.data)return 0;let a=null;for(let b of u.data){for(let c of b.schedule){if("paid"===c.status)continue;let b=(c.totalDuePoisha||0)-(c.paidPoisha||0);if(!(b<=0)){a=b;break}}if(a)break}return a||0},[u.data,f.role]);if(!s)return null;if("user"===f.role&&s.cards.length){let a=s.cards[0],c=v.data||a.recent||[];return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)(j.default,{eyebrow:"My savings",title:`Hi ${f.name||"there"}, here’s the current picture`,description:"Balance, what you’ve contributed so far, and upcoming instalments if any are still pending."}),(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-3",children:[(0,b.jsx)(g,{label:"Savings balance",value:(0,h.formatBDT)(s.groupBalance)}),(0,b.jsx)(g,{label:"Total contributed",value:(0,h.formatBDT)(s.totalDeposits)}),A>0?(0,b.jsx)(g,{label:"Next payment due",value:(0,h.formatBDT)(A),helper:"Covers your oldest pending instalment"}):null]}),t?(0,b.jsx)("p",{className:"text-xs text-slate-500",children:"Refreshing your dashboard…"}):null,(0,b.jsxs)(e.default,{title:"Recent activity",description:"Only transactions tied to your name appear here.",children:[(0,b.jsxs)("div",{className:"grid grid-cols-12 text-xs text-slate-500 px-2",children:[(0,b.jsx)("div",{className:"col-span-3",children:"Date"}),(0,b.jsx)("div",{className:"col-span-5",children:"Details"}),(0,b.jsx)("div",{className:"col-span-4 text-right",children:"Amount"})]}),(0,b.jsx)("div",{className:"max-h-72 overflow-auto divide-y divide-slate-100 dark:divide-slate-800",children:c.length?c.map(a=>(0,b.jsxs)("div",{className:"grid grid-cols-12 items-center py-2 px-2 text-sm",children:[(0,b.jsx)("span",{className:"col-span-3",children:new Date(a.occurredAt||a.date).toLocaleDateString("en-BD")}),(0,b.jsx)("span",{className:`col-span-5 ${"deposit"===a.type?"text-emerald-600":"text-rose-600"}`,children:a.note||a.type}),(0,b.jsx)("span",{className:"col-span-4 text-right",children:(0,h.formatBDT)(a.amount)})]},a._id||a.date)):(0,b.jsx)("div",{className:"text-sm text-slate-500 px-2 py-3",children:"No transactions recorded yet."})})]})]})}let B=(0,c.useMemo)(()=>{if(!s)return[];let a=[{label:"Total balance",value:(0,h.formatBDT)(s.groupBalance),helper:"Tap to compare deposits vs. deductions",onClick:()=>q(!0)},{label:"Available cash",value:(0,h.formatBDT)(s.groupBalance),helper:"See every member’s balance",onClick:()=>k.push("/balances")},{label:"Active members",value:s.membersCount,helper:"Counting only active profiles"},{label:"Open dues",value:s.arrearsCount,helper:"Members behind on instalments"}],b=s.investments||{principal:0,expectedInterest:0};return a.push({label:"Invested funds",value:(0,h.formatBDT)(b.principal),helper:"Currently out earning returns"},{label:"Expected interest",value:(0,h.formatBDT)(b.expectedInterest)},{label:"Total collected",value:(0,h.formatBDT)(s.totalDeposits)}),a},[s,k]);return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2 xl:grid-cols-4",children:B.map(a=>(0,b.jsx)(g,{label:a.label,value:a.value,helper:a.helper,onClick:a.onClick},String(a.label)))}),"user"!==f.role?(0,b.jsx)(z,{}):null,t?(0,b.jsx)("p",{className:"text-xs text-slate-500",children:"Refreshing data…"}):null,(0,b.jsx)(e.default,{title:"Members at a glance",description:"Open any member to record deposits, withdrawals, or review their ledger.",children:(0,b.jsx)("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2 xl:grid-cols-3",children:s.cards.map(a=>(0,b.jsx)(i,{member:a,onSelect:a=>n(a)},a.userId))})}),(0,b.jsx)(m.AnimatePresence,{children:l?(0,b.jsx)(w,{userId:l,role:f.role,onClose:()=>n(null)}):null}),(0,b.jsx)(m.AnimatePresence,{children:p?(0,b.jsx)(x,{open:p,totalDeposits:s.totalDeposits,totalWithdraws:s.totalWithdraws,available:s.groupBalance,rows:s.cards,onClose:()=>q(!1)}):null})]})}a.s(["default",()=>A],74920)}];

//# sourceMappingURL=src_components_home_HomeClient_tsx_6ca06b1f._.js.map