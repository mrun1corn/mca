(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,75379,e=>{"use strict";function t(e){return new Intl.NumberFormat("en-BD",{style:"currency",currency:"BDT"}).format((e||0)/100)}e.s(["formatBDT",()=>t])},10007,e=>{"use strict";var t=e.i(43476),s=e.i(932);let a={primary:"bg-blue-600 text-white hover:bg-blue-500",secondary:"bg-white border border-blue-200 text-blue-700 hover:bg-blue-50",ghost:"bg-transparent text-slate-600 hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-800",danger:"bg-rose-600 text-white hover:bg-rose-500"};function l(e){let l,r,n,i,d=(0,s.c)(7);d[0]!==e?({variant:r,className:n,...l}=e,d[0]=e,d[1]=l,d[2]=r,d[3]=n):(l=d[1],r=d[2],n=d[3]);let o=void 0===r?"primary":r,c=void 0===n?"":n,u=`inline-flex items-center justify-center gap-1.5 rounded-lg px-4 py-2 text-sm font-medium transition disabled:opacity-50 disabled:cursor-not-allowed ${a[o]} ${c}`;return d[4]!==l||d[5]!==u?(i=(0,t.jsx)("button",{className:u,...l}),d[4]=l,d[5]=u,d[6]=i):i=d[6],i}e.s(["default",()=>l])},94657,e=>{"use strict";var t=e.i(43476),s=e.i(932),a=e.i(71645),l=e.i(10007),r=e.i(9165),n=e.i(75379);function i({userId:e}){let[s,i]=(0,a.useState)("simple"),[c,u]=(0,a.useState)(""),[m,h]=(0,a.useState)(()=>new Date().toISOString().slice(0,10)),[x,p]=(0,a.useState)("Deposit"),[b,g]=(0,a.useState)(!0),[f,v]=(0,a.useState)([]),[j,y]=(0,a.useState)(null),[k,N]=(0,a.useState)(!1),[w,S]=(0,a.useState)(!1),[_,D]=(0,a.useState)(null),[C,B]=(0,a.useState)([]),[P,T]=(0,a.useState)(null),[E,$]=(0,a.useState)(!1),[A,F]=(0,a.useState)(null);(0,a.useEffect)(()=>{u(""),y(null)},[e]),(0,a.useEffect)(()=>{"pay_due"===s&&(N(!0),D(null),fetch(`${(0,r.getBrowserApiBase)()}/users/${e}/dues`,{credentials:"include"}).then(async e=>{if(!e.ok)throw Error("Failed to load dues");let t=await e.json();v(t),t.length&&!j&&y(t[0]._id)}).catch(e=>D(e?.message||"Failed to load dues")).finally(()=>N(!1)))},[s,e,j]);let I=f.length>0;(0,a.useEffect)(()=>{"pay_due"===s&&I&&!j&&y(f[0]._id)},[s,I,f,j]),(0,a.useEffect)(()=>{"investment_return"===s&&($(!0),F(null),fetch(`${(0,r.getBrowserApiBase)()}/investments`,{credentials:"include"}).then(async e=>{if(!e.ok)throw Error((await e.json())?.error||"Failed to load investments");let t=await e.json();B(t),t.length&&T(t[0].id)}).catch(e=>F(e?.message||"Failed to load investments")).finally(()=>$(!1)))},[s]),(0,a.useEffect)(()=>{p(e=>"investment_return"===s&&"Deposit"===e?"Investment return":"investment_return"!==s&&"Investment return"===e?"Deposit":e)},[s]);let O=(0,a.useMemo)(()=>f.find(e=>e._id===j),[f,j]),R=(0,a.useMemo)(()=>{if(!O)return 0;let e=new Date(m),t=O.penaltyRule?.graceDays??3,s=O.penaltyRule?.monthlyPenaltyPct??1;for(let a of O.schedule){if("paid"===a.status)continue;let l=(a.totalDuePoisha||0)-(a.paidPoisha||0);if(l<=0)continue;let r=new Date(a.dueDate);r.setDate(r.getDate()+t);let n=l;return b&&e>r&&O.penaltyRule?.enabled&&(n+=Math.floor(a.totalDuePoisha*s/100)),n}return 0},[O,b,m]),K=async()=>{if(e){S(!0),D(null);try{if("investment_return"===s){if(!P)throw Error("Pick an investment to credit the return against.");let e=Number(c);if(!e||!Number.isFinite(e))throw Error("Enter the amount that came back.");let t=await fetch(`${(0,r.getBrowserApiBase)()}/investments/${P}/return`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:e,date:m,note:x})});if(!t.ok)throw Error((await t.json())?.error||"Failed to record investment return");u(""),i("simple"),T(null);return}let t={userId:e,mode:s,date:m,note:x,includePenalty:b},a=Number(c);c?t.amount=Number.isFinite(a)?a:0:t.amountPoisha=R||0,"pay_due"===s&&(t.dueId=j);let l=await fetch(`${(0,r.getBrowserApiBase)()}/deposit`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!l.ok)throw Error((await l.json())?.error||"Deposit failed");u("")}catch(e){D(e?.message||"Deposit failed")}finally{S(!1)}}};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("section",{className:"rounded-2xl border border-slate-200 dark:border-slate-800 p-4 bg-white/70 dark:bg-slate-900/40 space-y-4",children:[(0,t.jsxs)("header",{className:"flex flex-col gap-2",children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-400",children:"Step 1"}),(0,t.jsx)("h3",{className:"text-base font-semibold text-slate-900 dark:text-white",children:"Choose the intent"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[(0,t.jsx)(o,{title:"Simple deposit",body:"Keeps the balance free for future withdrawals.",active:"simple"===s,onClick:()=>i("simple")}),(0,t.jsx)(o,{title:"Pay down a due",body:I?"Apply this to their repayment schedule.":"No open dues right now.",active:"pay_due"===s,onClick:()=>i("pay_due"),disabled:!I}),(0,t.jsx)(o,{title:"Investment return",body:"Re-add money that just came back from an investment.",active:"investment_return"===s,onClick:()=>i("investment_return")})]}),"pay_due"===s&&(0,t.jsxs)("div",{className:"rounded-2xl border border-blue-100 dark:border-blue-500/30 bg-blue-50/60 dark:bg-blue-500/10 p-4 space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,t.jsx)("h4",{className:"text-sm font-semibold text-slate-900 dark:text-white",children:"Target a due"}),(0,t.jsx)("span",{className:"text-xs text-blue-600 dark:text-blue-200 font-medium bg-blue-100/70 dark:bg-blue-500/20 px-2 py-0.5 rounded-full",children:k?"Loading…":`${f.length} open`})]}),(0,t.jsxs)("select",{className:"input-like",value:j||"",onChange:e=>y(e.target.value),children:[(0,t.jsx)("option",{value:"",children:"Select due…"}),f.map(e=>(0,t.jsxs)("option",{value:e._id,children:["Principal ",(0,n.formatBDT)(e.principal)," — ",e.months," mo @ ",e.monthlyRatePct,"%"]},e._id))]}),(0,t.jsxs)("label",{className:"inline-flex items-center gap-2 text-sm",children:[(0,t.jsx)("input",{type:"checkbox",checked:b,onChange:e=>g(e.target.checked)}),"Add penalty when grace period is over"]}),(0,t.jsxs)("div",{className:"text-xs text-blue-700 dark:text-blue-200 bg-white/60 dark:bg-slate-900/40 rounded-xl px-3 py-2 inline-flex items-center gap-2",children:["Suggested instalment: ",(0,t.jsx)("strong",{children:(0,n.formatBDT)(R)})]})]}),"investment_return"===s&&(0,t.jsxs)("div",{className:"rounded-2xl border border-emerald-200 dark:border-emerald-500/40 bg-emerald-50/60 dark:bg-emerald-500/10 p-4 space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,t.jsx)("h4",{className:"text-sm font-semibold text-slate-900 dark:text-white",children:"Select the investment"}),(0,t.jsx)("span",{className:"text-xs text-emerald-700 dark:text-emerald-200 font-medium bg-white/70 dark:bg-slate-900/40 px-2 py-0.5 rounded-full",children:E?"Loading…":`${C.length} recorded`})]}),(0,t.jsxs)("select",{className:"input-like",value:P||"",onChange:e=>T(e.target.value||null),children:[(0,t.jsx)("option",{value:"",children:"Pick an investment…"}),C.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.name," · ","completed"===e.status?"Completed":"Active"," (",(0,n.formatBDT)(e.amountPoisha),")"]},e.id))]}),A?(0,t.jsx)("p",{className:"text-sm text-rose-500",children:A}):null,C.length||E?null:(0,t.jsx)("p",{className:"text-sm text-slate-500",children:"No investments recorded yet."})]})]}),(0,t.jsxs)("section",{className:"rounded-2xl border border-slate-200 dark:border-slate-800 p-4 bg-white/80 dark:bg-slate-900/50 space-y-4",children:[(0,t.jsxs)("header",{children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-400",children:"Step 2"}),(0,t.jsx)("h3",{className:"text-base font-semibold text-slate-900 dark:text-white",children:"Fill in the details"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,t.jsx)(d,{label:"Amount (BDT)",children:(0,t.jsx)("input",{className:"input-like",type:"number",step:"0.01",placeholder:"0.00",value:c,onChange:e=>u(e.target.value)})}),(0,t.jsx)(d,{label:"Date",children:(0,t.jsx)("input",{className:"input-like",type:"date",value:m,onChange:e=>h(e.target.value)})})]}),(0,t.jsx)(d,{label:"Note",children:(0,t.jsx)("input",{className:"input-like",value:x,onChange:e=>p(e.target.value)})}),_?(0,t.jsx)("p",{className:"text-sm text-rose-500",children:_}):null]}),(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsx)(l.default,{onClick:K,disabled:w,children:w?"Saving…":"Save deposit"})})]})}function d(e){let a,l,r=(0,s.c)(5),{label:n,children:i}=e;return r[0]!==n?(a=(0,t.jsx)("label",{className:"text-sm font-medium text-slate-600 dark:text-slate-300",children:n}),r[0]=n,r[1]=a):a=r[1],r[2]!==i||r[3]!==a?(l=(0,t.jsxs)("div",{className:"space-y-1",children:[a,i]}),r[2]=i,r[3]=a,r[4]=l):l=r[4],l}function o(e){let a,l,r,n=(0,s.c)(10),{title:i,body:d,active:o,onClick:c,disabled:u}=e,m=`rounded-2xl border p-4 text-left transition disabled:opacity-60 disabled:cursor-not-allowed ${o?"border-blue-400 bg-blue-50 text-blue-700 dark:border-blue-500 dark:bg-blue-500/10 dark:text-blue-200":"border-slate-200 dark:border-slate-700 hover:border-blue-200 hover:bg-blue-50/40 dark:hover:border-blue-500/40 dark:hover:bg-slate-800"}`;return n[0]!==i?(a=(0,t.jsx)("p",{className:"font-semibold",children:i}),n[0]=i,n[1]=a):a=n[1],n[2]!==d?(l=(0,t.jsx)("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:d}),n[2]=d,n[3]=l):l=n[3],n[4]!==u||n[5]!==c||n[6]!==m||n[7]!==a||n[8]!==l?(r=(0,t.jsxs)("button",{type:"button",onClick:c,disabled:u,className:m,children:[a,l]}),n[4]=u,n[5]=c,n[6]=m,n[7]=a,n[8]=l,n[9]=r):r=n[9],r}e.s(["default",()=>i])},76280,e=>{"use strict";var t=e.i(43476),s=e.i(932),a=e.i(71645),l=e.i(94657);function r(e){let r,i,d,o,c,u,m,h,x=(0,s.c)(15),{users:p}=e,[b,g]=(0,a.useState)(p[0]?.id??"");return x[0]===Symbol.for("react.memo_cache_sentinel")?(r=(0,t.jsx)("label",{className:"text-sm font-medium text-slate-600 dark:text-slate-300",children:"Who is saving today?"}),x[0]=r):r=x[0],x[1]===Symbol.for("react.memo_cache_sentinel")?(i=e=>g(e.target.value),x[1]=i):i=x[1],x[2]!==p?(d=p.map(n),x[2]=p,x[3]=d):d=x[3],x[4]!==d||x[5]!==b?(o=(0,t.jsx)("select",{className:"input-like",value:b,onChange:i,children:d}),x[4]=d,x[5]=b,x[6]=o):o=x[6],x[7]===Symbol.for("react.memo_cache_sentinel")?(c=(0,t.jsx)("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Need to add someone first? Head to the People page, then swing back here."}),x[7]=c):c=x[7],x[8]!==o?(u=(0,t.jsxs)("div",{className:"space-y-2",children:[r,o,c]}),x[8]=o,x[9]=u):u=x[9],x[10]!==b?(m=b?(0,t.jsx)(l.default,{userId:b}):(0,t.jsx)("p",{className:"text-sm text-slate-500",children:"Select a member to unlock the form."}),x[10]=b,x[11]=m):m=x[11],x[12]!==u||x[13]!==m?(h=(0,t.jsxs)("div",{className:"space-y-4",children:[u,m]}),x[12]=u,x[13]=m,x[14]=h):h=x[14],h}function n(e){return(0,t.jsx)("option",{value:e.id,children:e.name},e.id)}e.s(["default",()=>r])}]);